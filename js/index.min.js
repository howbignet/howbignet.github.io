function analyzeUrl(){var e=document.getElementById("SelectorBox").getBoundingClientRect(),t=document.elementFromPoint(e.left+e.width/2,e.top+e.height/2),i=$(t).attr("data-url"),a=$(t).attr("data-image-name"),n=$(t).attr("data-json");void 0==a&&(a=null),updateThumbnail(i),""==n?alert("Still didn't update this pic, please change another one"):(progressHandlingFunction({lengthComputable:"1"}),setTimeout(function(){var e=JSON.parse(n);showResultView(),showResultRec(e)},500))}function updateThumbnail(e){var t=document.getElementById("thumbnail");t.setAttribute("src",e)}function showResultView(){window.location.hash="results",$("#selectImage").hide(),$("#results").show()}function showSelectionView(){$("#selectImage").show(),$("#results").hide(),$("#faceRecArea").css("visibility","hidden"),sly.activate(girlNumStarting)}function showResultRec(e){$("#analyzingLabel").html("");var t=parseInt(e.boundingBox[0]),i=parseInt(e.boundingBox[1]),a=parseInt(e.boundingBox[2]),n=parseInt(e.boundingBox[3]),o=parseInt($("#thumbnail").css("margin-left").replace("px",""))||0,l=$("#thumbnail").prop("naturalWidth"),r=$("#thumbnail").prop("naturalHeight"),s=$("#thumbnail").width(),c=$("#thumbnail").height(),h=(a-t)*(s/l),d=(n-i)*(c/r),g=t*(s/l),u=i*(s/l);0==t&&0==i&&0==a&&0==n?($("#analyzingLabel").html("<span>Not found...</span>"),$("#faceRecArea").css("visibility","hidden"),$("#tooltip-inner").html("?")):($("#faceRecArea").css("visibility","visible"),$("#faceRecArea").css("top",u),$("#faceRecArea").css("left",o+g),$("#faceRecArea").css("width",h),$("#faceRecArea").css("height",d),$("#tooltip-inner").html(e.cup))}function progressHandlingFunction(e){e.lengthComputable&&(window.location.hash="results",$("#jsonEventDiv").hide(),$("#analyzingLabel").css("visibility","visible"),$("#improvingLabel").css("visibility","hidden"),$("#faceRecArea").css("visibility","hidden"),$("#analyzingLabel").html('Analyzing...&nbsp;&nbsp;&nbsp;<span><img id="loadingImage" src="./img/ajax-loader.gif" width="40" height="40"/></span>'))}var girlNumStarting=4,current_faces,$example=$("#example"),$frame=$example.find(".frame"),sly=new Sly($frame,{horizontal:1,itemNav:"forceCentered",activateMiddle:1,smart:1,activateOn:"click",mouseDragging:1,touchDragging:1,releaseSwing:1,startAt:girlNumStarting,scrollBar:$example.find(".scrollbar"),scrollBy:1,activatePageOn:"click",speed:200,moveBy:600,elasticBounds:1,dragHandle:1,dynamicHandle:1,clickBar:1}).init();$frame.css("overflow","visible");var dataURLToBlob=function(e){var t=";base64,";if(-1==e.indexOf(t)){var i=e.split(","),a=i[0].split(":")[1],n=i[1];return new Blob([n],{type:a})}for(var i=e.split(t),a=i[0].split(":")[1],n=window.atob(i[1]),o=n.length,l=new Uint8Array(o),r=0;o>r;++r)l[r]=n.charCodeAt(r);return new Blob([l],{type:a})};$("#uploadBtn").change(function(){{var e=this.files[0],t=e.name;e.size,e.type}if(e.type.match(/image.*/)){console.log("An image has been loaded");var i=new FileReader;i.onload=function(e){base64=this.result.replace(/^.*?,/,""),exif=EXIF.readFromBinaryFile(new BinaryFile(atob(base64))),orient=parseInt(exif.Orientation);var i=new Image;i.onload=function(){var e,a,n=document.createElement("canvas"),o=n.getContext("2d");6==orient||8==orient?(e=i.height,a=i.width):(e=i.width,a=i.height);var l=400,r=400;e>=a&&e>l?(a=l*a/e,e=l):a>e&&a>r&&(e=r*e/a,a=r),n.width=e,n.height=a;var s={x:0,y:0,r:0,width:n.width,height:n.height};orient&&[3,6,8].indexOf(orient)>-1&&(s.x=n.width/2,s.y=n.height/2,(8===orient||6===orient)&&(s.width=n.height,s.height=n.width),6===orient&&(s.r=Math.PI/2),3===orient&&(s.r=Math.PI),8===orient&&(s.r=-Math.PI/2),o.translate(s.x,s.y),o.rotate(s.r),3===orient?o.translate(-s.x,-s.y):o.translate(-s.y,-s.x)),o.drawImage(i,0,0,s.width,s.height);var c=n.toDataURL("image/jpeg"),h=dataURLToBlob(c);console.log(h),console.log(c),$.event.trigger({type:"imageResized",blob:h,base64:c,fileName:t,url:c})},i.src=e.target.result},i.readAsDataURL(e)}}),$(document).on("imageResized",function(e){var t=new FormData($("form")[1]);e.blob&&e.url&&(t.append("photo",e.blob,e.fileName),$.ajax({url:"http://52.68.199.160:80/upload_photo",type:"POST",success:function(t){var i=JSON.stringify(t);console.log("Complete: "),console.log(i),$("#improvingLabel").css("visibility","visible"),"ok"==t.state?(console.log("Analysis OK"),updateThumbnail(e.base64),showResultRec(t)):console.log("Server Analysis Error")},error:function(){alert("Sorry, our employees are taking rest now."),$("#analyzingLabel").html("Sorry, our employees are taking rest now."),$("#analyzingLabel").css("visibility","visible"),$("#improvingLabel").css("visibility","visible"),$("#faceRecArea").css("visibility","hidden")},xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&(t.upload.addEventListener("progress",progressHandlingFunction,!1),updateThumbnail(e.base64)),t},complete:function(){console.log("complete"),$("#uploadBtn").val("")},data:t,cache:!1,contentType:!1,processData:!1}))}),$(window).load(function(){window.location.hash=""}),$(window).on("hashchange",function(){"#results"===window.location.hash?showResultView():showSelectionView()});